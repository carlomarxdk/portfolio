{{if .Params.highlight}}
  <article class="card bg-slate-50 shadow-md">
{{else}}
  <article class="card">
{{end}}
  <div class="card-date">
    <time datetime="{{ .Params.publishDate.Format "2006-01" }}" class="text-center tracking-tight text-gray-700 text-sm font-semibold">{{ .Params.publishDate.Format "Jan 2006" }}</time>
  </div>
  <div class="card-content">
    <h3 class="mb-1 md:mb-1.5 text-lg font-bold tracking-normal text-gray-950">
      {{ if .Params.pub_link }}
        <a href="{{ .Params.pub_link }}" target="_blank" rel="noopener" class="a-hov">{{ .Title }}</a>
      {{ else }} 
        {{ .Title }}
      {{ end }}
    </h3>
   <!-- <p class="authors">{{ .Params.authors }}</p> -->
   <p class=" text-sm tracking-tight text-gray-700">
    {{if .Params.authors}}
    {{ $len := len .Params.authors }}
    {{ range $index, $element := .Params.authors }}
      {{ if eq $element "Germans Savcisens" }}
        <strong class="font-bold">{{ $element }}</strong>
      {{ else }}
        {{ $element }}
      {{ end }}
      {{ if ne (add $index 1) $len }},{{ end }}
    {{ end }}
    {{end}}
   </p>
    <p class="text-sm tracking-tight font-semibold text-gray-500 pt-1">{{ .Params.venue }}</p>
    <p class="mt-1 md:mt-1.5">
      {{if .Params.misc}}
        {{ $.Scratch.Delete "groupNames" }}
        {{ $.Scratch.Set "groupNames" slice }}
        {{ range $index, $item := .Params.misc }}
          {{ $baseName := "" }}
          {{ if or (hasPrefix $item.name "Poster") (hasPrefix $item.name "Slides") (hasPrefix $item.name "Presentation") }}
            {{ $baseName = index (split $item.name " ") 0 }}
          {{ else }}
            {{ $baseName = $item.name }}
          {{ end }}
          {{ $scratchKey := printf "list-%s" $baseName }}
          {{ if $.Scratch.Get $scratchKey }}
            {{ $.Scratch.Add $scratchKey (slice $item) }}
          {{ else }}
            {{ $.Scratch.Set $scratchKey (slice $item) }}
            {{ $.Scratch.Add "groupNames" (slice $baseName) }}
          {{ end }}
        {{ end }}

        {{ $groupNames := $.Scratch.Get "groupNames" }}
        {{ range $groupIdx, $baseName := $groupNames }}
          {{ $scratchKey := printf "list-%s" $baseName }}
          {{ $items := $.Scratch.Get $scratchKey }}
          {{ if gt (len $items) 1 }}
            {{ $popoverId := printf "popover-misc-%s-%d" $.Params.fact_id $groupIdx }}
            {{ $pluralName := $baseName }}
            {{ if not (or (hasSuffix $baseName "s") (hasSuffix $baseName "x") (hasSuffix $baseName "z")) }}
              {{ $pluralName = printf "%ss" $baseName }}
            {{ end }}
            <button data-popover-target="{{ $popoverId }}" type="button" class="inline-block px-2 py-1.5 text-xs font-semibold border hover:border-gray-200 rounded-xl 
            hover:bg-clip-text hover:text-transparent bg-gradient-to-tr from-blue-500 to-pink-500
            transition-all duration-200
            bg-clip-border text-white hover:shadow-sm" aria-label="View {{ $baseName }} options for {{ $.Title }}">
              {{ $pluralName }}
            </button>
            <div data-popover id="{{ $popoverId }}" role="tooltip" class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-lg opacity-0">
              <div class="px-3 py-2 bg-gradient-to-tr from-blue-500 to-pink-500 border-b border-gray-200 rounded-t-lg">
                <h4 class="font-semibold text-white">{{ $pluralName }}</h4>
              </div>
              <div class="px-3 py-2">
                {{ range $idx, $item := $items }}
                  <a href="{{ $item.link }}" target="_blank" rel="noopener" class="block py-1.5 text-gray-700 hover:text-blue-600 hover:underline">
                    {{ if $item.name }}{{ $item.name }}{{ else }}{{ $baseName }} {{ add $idx 1 }}{{ end }}
                  </a>
                {{ end }}
              </div>
              <div data-popper-arrow></div>
            </div>
          {{ else }}
            {{ range $items }}
              <a
              href="{{ .link }}"
              class="inline-block px-2 py-1.5 text-xs font-semibold border hover:border-gray-200 rounded-xl 
              hover:bg-clip-text hover:text-transparent bg-gradient-to-tr from-blue-500 to-pink-500
              transition-all duration-200
              bg-clip-border text-white hover:shadow-sm"
              target="_blank"
              rel="noopener"
              aria-label="{{.name}} for {{ $.Title }}"
            >
            {{.name}}</a>
            {{ end }}
          {{ end }}
        {{ end }}
      {{end}}
      
      {{if .Params.allow_fact}}
        {{ $factPopoverId := printf "popover-fact-%s" .Params.fact_id }}
        <button data-popover-target="{{ $factPopoverId }}" type="button" class="inline-block px-2 py-1.5 text-xs font-semibold border hover:border-gray-200 rounded-xl 
        hover:bg-clip-text hover:text-transparent bg-gradient-to-tr from-blue-500 to-pink-500
        transition-all duration-200
        bg-clip-border text-white hover:shadow-sm" aria-label="Show random information about this publication">Random Info</button>
        <div data-popover id="{{ $factPopoverId }}" role="tooltip" class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-lg opacity-0">
          <div class="px-3 py-2 bg-gradient-to-tr from-blue-500 to-pink-500 border-b border-gray-200 rounded-t-lg">
            <h4 class="font-semibold text-white">Random Facts</h4>
          </div>
          <div class="px-3 py-2 pt-0.5">
            <p>{{.Content}}</p>
          </div>
          <div data-popper-arrow></div>
        </div>
      {{end}}
    </p>
  </div>
</article>
